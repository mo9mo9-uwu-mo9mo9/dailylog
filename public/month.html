<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æœˆæ¬¡ä¸€è¦§ï½œç”Ÿæ´»è¡Œå‹•è¡¨</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      :root {
        --cell-h: 14px;
        --grid-gap: 2px;
        --cell-radius: 2px;
        --cell-border: 0;
        /* 4ã‚«ãƒ©ãƒ ç”¨ã®åˆ—å¹…ï¼ˆèª¿æ•´ã—ã‚„ã™ã„ã‚ˆã†ã«CSSå¤‰æ•°åŒ–ï¼‰ */
        --col-date: 36px; /* DD 2æ¡ */
        --col-metrics: 150px;
        --col-note: 220px;
        --row-sep-color: #e5e5e5; /* è¡Œã®åŒºåˆ‡ã‚Šç·šï¼ˆç”»é¢ï¼‰ */
      }
      body {
        padding: 8px;
      }
      .head {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .head h2 {
        margin: 6px 0;
      }
      .legend {
        font-size: 12px;
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 6px;
        margin-left: auto;
      }
      .legend div {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .box {
        width: 10px;
        height: 10px;
        border: 1px solid #333;
      }
      .monthwrap {
        margin-top: 8px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 6px;
      }
      /* åˆ—è¦‹å‡ºã—ï¼ˆ2ã‚«ãƒ©ãƒ : æ—¥ä»˜ | å†…å®¹ï¼‰ */
      .colhead {
        display: grid;
        grid-template-columns: var(--col-date) 1fr;
        gap: 6px;
        align-items: center;
        font-size: 12px;
        color: #333;
        margin-top: 6px;
        border-bottom: 1px solid var(--row-sep-color, #e5e5e5);
        padding-bottom: 4px;
      }
      .colhead div {
        font-weight: 700;
      }
      /* æ™‚é–“ç›®ç››ã‚Šï¼ˆã‚°ãƒ©ãƒ•ã®æ™‚é–“è»¸ï¼‰ */
      .timescale {
        display: grid;
        grid-template-columns: var(--col-date) 1fr;
        gap: 6px;
        align-items: center;
        color: #666;
        font-size: 11px;
      }
      .timegrid {
        display: grid;
        grid-template-columns: repeat(24, 1fr);
        column-gap: var(--grid-gap);
        height: 16px;
        align-items: end;
        position: relative; /* 24:00 å¢ƒç•Œç·šã¨ãƒ©ãƒ™ãƒ«ã®ãŸã‚ */
      }
      .timegrid .tick {
        position: relative;
        border-left: 1px solid #ddd;
        height: 12px;
      }
      .timegrid .tick.major {
        border-left-color: #aaa;
        height: 14px;
      }
      .timegrid .tick .lab {
        position: absolute;
        bottom: 0;
        transform: translateX(-50%);
        left: 0;
        font-size: 10px;
        white-space: nowrap;
        pointer-events: none;
      }
      .timegrid::after {
        content: '';
        position: absolute;
        right: 0;
        bottom: 0;
        border-left: 1px solid #aaa; /* 24:00 å¢ƒç•Œç·š */
        height: 14px;
      }
      .timegrid .end-label {
        position: absolute;
        right: 0;
        bottom: 0;
        transform: translateX(50%);
        font-size: 11px;
        color: #666;
      }
      .dayrow {
        display: grid;
        /* 2ã‚«ãƒ©ãƒ : æ—¥ä»˜ | å†…å®¹ï¼ˆå†…å®¹ã¯ä¸Šä¸‹2æ®µ: ã‚°ãƒ©ãƒ•/ãƒ¡ã‚¿ï¼‰ */
        grid-template-columns: var(--col-date) 1fr;
        gap: 6px;
        align-items: center;
        padding: 2px 0;
        border-bottom: 1px solid var(--row-sep-color);
      }
      .monthwrap .dayrow:first-child {
        border-top: 1px solid var(--row-sep-color);
      }
      .daydate {
        display: flex;
        align-items: center;
        justify-content: center;
        height: var(--cell-h);
        line-height: var(--cell-h);
        font-weight: 600;
        font-size: 12px;
        color: #444;
      }
      .daycontent {
        display: grid;
        grid-template-rows: auto auto;
        row-gap: 4px;
        align-items: start;
      }
      .meta {
        display: flex;
        gap: 12px;
        align-items: center;
        min-height: 14px;
      }
      .metrics {
        font-size: 12px;
        color: #333;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .note {
        font-size: 12px;
        color: #444;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
      }
      .grid48 {
        display: grid;
        /* 48åˆ—=30åˆ†å˜ä½ã‚’æ¨ªä¸€åˆ—ã«å±•é–‹ï¼ˆæŠ˜è¿”ã—ç„¡ã—ï¼‰ */
        grid-template-columns: repeat(48, 1fr);
        gap: var(--grid-gap);
      }
      .cell {
        height: var(--cell-h);
        border: var(--cell-border);
        border-radius: var(--cell-radius);
      }
      .muted {
        color: #666;
        font-size: 12px;
      }
      @media print {
        body {
          padding: 0;
        }
        .noprint {
          display: none;
        }
        .legend,
        .dayrow {
          break-inside: avoid;
          page-break-inside: avoid;
        }
        .metrics,
        .note {
          font-size: 12px; /* å°åˆ·æ™‚ã‚‚è¦–èªæ€§ã‚’ç¶­æŒ */
        }
        /* å°åˆ·æ™‚: è¡Œç½«ç·šã‚’å¼·èª¿ã€èƒŒæ™¯ã¯ç„¡åŠ¹åŒ– */
        .dayrow {
          background: none !important;
          border-bottom: 0.2mm solid #000;
        }
        .monthwrap .dayrow:first-child {
          border-top: 0.2mm solid #000;
        }
      }
      @media screen {
        /* ç”»é¢ã§ã¯è–„ã„ã‚¼ãƒ–ãƒ©èƒŒæ™¯ã§ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã—ã‚„ã™ã */
        .dayrow:nth-child(odd) {
          background: #fafafa;
        }
      }
    </style>
  </head>
  <body>
    <div class="head">
      <h2 id="mtitle">æœˆæ¬¡ä¸€è¦§</h2>
      <div class="legend" id="legend"></div>
      <label class="noprint" style="display: flex; align-items: center; gap: 6px">
        ã‚µãƒ³ãƒ—ãƒ«
        <select id="selSample">
          <option value="0">å®Ÿãƒ‡ãƒ¼ã‚¿</option>
          <option value="1">ã‚µãƒ³ãƒ—ãƒ«1: æ¨™æº–å‹¤å‹™æ—¥</option>
          <option value="2">ã‚µãƒ³ãƒ—ãƒ«2: å¤œå‹¤æ—¥</option>
          <option value="3">ã‚µãƒ³ãƒ—ãƒ«3: å­¦ç¿’é›†ä¸­æ—¥</option>
          <option value="4">ã‚µãƒ³ãƒ—ãƒ«4: æ—…è¡Œæ—¥</option>
          <option value="5">ã‚µãƒ³ãƒ—ãƒ«5: å®¶æ—ãƒ»ã‚±ã‚¢æ—¥</option>
          <option value="6">ã‚µãƒ³ãƒ—ãƒ«6: å›å¾©ï¼ˆä¼‘é¤Šï¼‰æ—¥</option>
        </select>
      </label>
      <label class="noprint" style="display: flex; align-items: center; gap: 6px">
        é…è‰²
        <select id="selPalette">
          <option value="hc">é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ</option>
          <option value="mid" selected>ãƒŸãƒ‰ãƒ«ï¼ˆæ¨™æº–ï¼‰</option>
          <option value="pastel">æ·¡è‰²ï¼ˆæ—§é…è‰²ï¼‰</option>
        </select>
      </label>
      <label class="noprint" style="display: flex; align-items: center; gap: 6px">
        é«˜ã•
        <select id="selHeight">
          <option value="10">10pxï¼ˆå¯†ï¼‰</option>
          <option value="14" selected>14pxï¼ˆæ¨™æº–ï¼‰</option>
          <option value="18">18pxï¼ˆåºƒï¼‰</option>
          <option value="22">22pxï¼ˆç‰¹å¤§ï¼‰</option>
        </select>
      </label>
      <button class="noprint" id="btnPrint">å°åˆ·</button>
    </div>
    <div class="muted" id="subtitle">
      å„è¡Œ: 30åˆ†Ã—24æ™‚é–“ã®æ¦‚æ³ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã€‚ã‚¯ãƒªãƒƒã‚¯ã§æ—¥æ¬¡ãƒšãƒ¼ã‚¸ã¸ã€‚
    </div>
    <div class="colhead" aria-hidden="false">
      <div>æ—¥ä»˜</div>
      <div>ã‚°ãƒ©ãƒ•ï¼æŒ‡æ¨™ãƒ»å‚™è€ƒ</div>
    </div>
    <div class="timescale" aria-hidden="false">
      <div></div>
      <div>
        <div class="timegrid" id="timegrid"></div>
      </div>
    </div>
    <div class="monthwrap" id="monthwrap"></div>
    <script>
      (async function () {
        const q = new URLSearchParams(location.search);
        const m = q.get('month') || new Date().toISOString().slice(0, 7);
        const sampleId = parseInt(q.get('sample') || '0', 10) || 0;
        const palQ = (q.get('pal') || '').toLowerCase();
        const storedPal = localStorage.getItem('dailylog.pal') || '';
        const palette = ['hc', 'mid', 'pastel'].includes(palQ)
          ? palQ
          : ['hc', 'mid', 'pastel'].includes(storedPal)
            ? storedPal
            : 'mid';
        document.body.classList.toggle('palette-hc', palette === 'hc');
        document.body.classList.toggle('palette-mid', palette === 'mid');
        document.body.classList.toggle('palette-pastel', palette === 'pastel');
        const hParam = parseInt(q.get('h') || '', 10);
        const storedH = parseInt(localStorage.getItem('dailylog.cell_h') || '', 10);
        const hPick = !Number.isNaN(hParam) ? hParam : !Number.isNaN(storedH) ? storedH : 14;
        if (hPick >= 8 && hPick <= 28) {
          document.documentElement.style.setProperty('--cell-h', hPick + 'px');
        }
        const useSample = sampleId > 0;
        document.getElementById('mtitle').textContent = `æœˆæ¬¡ä¸€è¦§ ${m}`;
        const CATS = [
          ['sleep', 'ç¡çœ '],
          ['work', 'ä»•äº‹'],
          ['study', 'å‹‰å¼·'],
          ['move', 'ç§»å‹•'],
          ['meal', 'é£Ÿäº‹'],
          ['exercise', 'é‹å‹•'],
          ['house', 'å®¶äº‹'],
          ['family', 'å®¶æ—ãƒ»ã‚±ã‚¢'],
          ['rest', 'ä¼‘æ†©'],
          ['other', 'ãã®ä»–'],
        ];
        const lg = document.getElementById('legend');
        for (const [v, lab] of CATS) {
          const dv = document.createElement('div');
          const bx = document.createElement('span');
          bx.className = 'box cat-' + v;
          dv.appendChild(bx);
          const sp = document.createElement('span');
          sp.textContent = lab;
          dv.appendChild(sp);
          lg.appendChild(dv);
        }
        // æ™‚é–“ç›®ç››ã‚Šï¼ˆ0..23h, 6æ™‚é–“ã”ã¨ã«ãƒ©ãƒ™ãƒ«ï¼‰
        const tg = document.getElementById('timegrid');
        if (tg) {
          for (let h = 0; h < 24; h++) {
            const tk = document.createElement('div');
            tk.className = 'tick' + (h % 3 === 0 ? ' major' : '');
            const lab = document.createElement('span');
            lab.className = 'lab';
            lab.textContent = String(h).padStart(2, '0') + ':00';
            tk.appendChild(lab);
            tg.appendChild(tk);
          }
          // 24:00 ãƒ©ãƒ™ãƒ«ï¼ˆå³ç«¯ï¼‰
          const endLab = document.createElement('span');
          endLab.className = 'end-label';
          endLab.textContent = '24:00';
          tg.appendChild(endLab);
        }

        function daysInMonth(ym) {
          const [Y, MM] = ym.split('-').map(Number);
          const last = new Date(Y, MM, 0).getDate();
          const out = [];
          for (let d = 1; d <= last; d++) {
            out.push(`${ym}-${String(d).padStart(2, '0')}`);
          }
          return out;
        }
        function range(a, b) {
          const out = [];
          for (let i = a; i < b; i++) out.push(i);
          return out;
        }
        const slot = (h, m) => h * 2 + (m >= 30 ? 1 : 0);
        function samplePlanForDay(d, sample) {
          const acts = [];
          const push = (start, end, cat, label) => {
            for (let i = start; i < end; i++) {
              acts.push({ slot: i, label, category: cat });
            }
          };
          const PB = (h1, m1, h2, m2, cat, label) => push(slot(h1, m1), slot(h2, m2), cat, label);
          switch (sample) {
            case 1: // æ¨™æº–å‹¤å‹™æ—¥
              PB(0, 0, 6, 30, 'sleep', 'ç¡çœ ');
              PB(6, 30, 7, 30, 'house', 'å®¶äº‹');
              PB(7, 30, 9, 0, 'move', 'ç§»å‹•');
              PB(9, 0, 12, 0, 'work', 'ä»•äº‹');
              PB(12, 0, 13, 0, 'meal', 'é£Ÿäº‹');
              PB(13, 0, 17, 0, 'work', 'ä»•äº‹');
              PB(17, 0, 18, 30, 'study', 'å‹‰å¼·');
              PB(18, 30, 19, 30, 'exercise', 'é‹å‹•');
              PB(19, 30, 21, 0, 'family', 'å®¶æ—ãƒ»ã‚±ã‚¢');
              PB(21, 0, 22, 0, 'meal', 'é£Ÿäº‹');
              PB(22, 0, 23, 0, 'rest', 'ä¼‘æ†©');
              PB(23, 0, 24, 0, 'sleep', 'ç¡çœ ');
              break;
            case 2: // å¤œå‹¤æ—¥
              PB(0, 0, 6, 0, 'work', 'ä»•äº‹');
              PB(6, 0, 7, 0, 'move', 'ç§»å‹•');
              PB(7, 0, 14, 30, 'sleep', 'ç¡çœ ');
              PB(14, 30, 15, 30, 'meal', 'é£Ÿäº‹');
              PB(15, 30, 17, 0, 'house', 'å®¶äº‹');
              PB(17, 0, 20, 0, 'family', 'å®¶æ—ãƒ»ã‚±ã‚¢');
              PB(20, 0, 21, 0, 'meal', 'é£Ÿäº‹');
              PB(21, 0, 24, 0, 'work', 'ä»•äº‹');
              break;
            case 3: // å­¦ç¿’é›†ä¸­æ—¥
              PB(0, 0, 7, 0, 'sleep', 'ç¡çœ ');
              PB(7, 0, 8, 0, 'house', 'å®¶äº‹');
              PB(8, 0, 9, 0, 'move', 'ç§»å‹•');
              PB(9, 0, 12, 0, 'study', 'å‹‰å¼·');
              PB(12, 0, 13, 0, 'meal', 'é£Ÿäº‹');
              PB(13, 0, 17, 0, 'study', 'å‹‰å¼·');
              PB(17, 0, 18, 0, 'exercise', 'é‹å‹•');
              PB(18, 0, 19, 0, 'move', 'ç§»å‹•');
              PB(19, 0, 20, 0, 'meal', 'é£Ÿäº‹');
              PB(20, 0, 22, 0, 'study', 'å‹‰å¼·');
              PB(22, 0, 24, 0, 'rest', 'ä¼‘æ†©');
              break;
            case 4: // æ—…è¡Œæ—¥
              PB(0, 0, 5, 0, 'sleep', 'ç¡çœ ');
              PB(5, 0, 6, 0, 'house', 'å®¶äº‹');
              PB(6, 0, 12, 0, 'move', 'ç§»å‹•');
              PB(12, 0, 13, 0, 'meal', 'é£Ÿäº‹');
              PB(13, 0, 17, 0, 'move', 'ç§»å‹•');
              PB(17, 0, 18, 0, 'rest', 'ä¼‘æ†©');
              PB(18, 0, 19, 0, 'meal', 'é£Ÿäº‹');
              PB(19, 0, 21, 0, 'family', 'å®¶æ—ãƒ»ã‚±ã‚¢');
              PB(21, 0, 24, 0, 'sleep', 'ç¡çœ ');
              break;
            case 5: // å®¶æ—ãƒ»ã‚±ã‚¢æ—¥
              PB(0, 0, 6, 30, 'sleep', 'ç¡çœ ');
              PB(6, 30, 8, 0, 'house', 'å®¶äº‹');
              PB(8, 0, 12, 0, 'family', 'å®¶æ—ãƒ»ã‚±ã‚¢');
              PB(12, 0, 13, 0, 'meal', 'é£Ÿäº‹');
              PB(13, 0, 16, 0, 'family', 'å®¶æ—ãƒ»ã‚±ã‚¢');
              PB(16, 0, 17, 0, 'move', 'ç§»å‹•');
              PB(17, 0, 18, 0, 'exercise', 'é‹å‹•');
              PB(18, 0, 20, 0, 'family', 'å®¶æ—ãƒ»ã‚±ã‚¢');
              PB(20, 0, 21, 0, 'meal', 'é£Ÿäº‹');
              PB(21, 0, 22, 0, 'house', 'å®¶äº‹');
              PB(22, 0, 24, 0, 'rest', 'ä¼‘æ†©');
              break;
            case 6: // å›å¾©ï¼ˆä¼‘é¤Šï¼‰æ—¥
              PB(0, 0, 9, 0, 'sleep', 'ç¡çœ ');
              PB(9, 0, 10, 0, 'meal', 'é£Ÿäº‹');
              PB(10, 0, 12, 0, 'rest', 'ä¼‘æ†©');
              PB(12, 0, 13, 0, 'meal', 'é£Ÿäº‹');
              PB(13, 0, 15, 0, 'rest', 'ä¼‘æ†©');
              PB(15, 0, 16, 0, 'exercise', 'é‹å‹•');
              PB(16, 0, 18, 0, 'rest', 'ä¼‘æ†©');
              PB(18, 0, 19, 0, 'meal', 'é£Ÿäº‹');
              PB(19, 0, 24, 0, 'sleep', 'ç¡çœ ');
              break;
            default:
              return samplePlanForDay(d, 1);
          }
          return acts;
        }
        function sampleMetricsForDay(d, sample) {
          // ã‚µãƒ³ãƒ—ãƒ«ç”¨ã®ãƒ€ãƒŸãƒ¼æŒ‡æ¨™ï¼ˆæ¦‚ã­ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æ²¿ã£ãŸå€¤ï¼‰
          const dd = Number(d.slice(8, 10));
          const pick = (arr) => arr[(dd - 1) % arr.length];
          switch (sample) {
            case 1: {
              const notes = [
                'åœ¨å®…: æœä¼šãƒ»1on1',
                'å‡ºç¤¾: é€²æ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
                'è¦ä»¶å®šç¾©ãƒ¡ãƒ¢æ›´æ–°',
                'è³‡æ–™ä½œæˆ: ææ¡ˆãƒ‰ãƒ©ãƒ•ãƒˆ',
                'æ®‹æ¥­1h: ãƒªãƒªãƒ¼ã‚¹æº–å‚™',
                'å‡ºå¼µæ‰‹é…ãƒ»ç²¾ç®—',
                'é›‘å‹™æ¶ˆåŒ–ãƒ»ãƒ˜ãƒ«ãƒ—å¯¾å¿œ',
              ];
              let note = pick(notes);
              if (dd % 7 === 0)
                note =
                  'é•·æ–‡: éƒ¨ç½²æ¨ªæ–­ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è­°äº‹è¦ç´„ã€‚æ±ºå®šäº‹é …/å®¿é¡Œ/æœŸé™ã‚’æ•´ç†ã—é–¢ä¿‚è€…ã¸å…±æœ‰ã€‚';
              if (dd % 5 === 0) note = '';
              return {
                sleep_minutes: 6 * 60 + 30,
                fatigue: { morning: 3, noon: 4, night: 5 },
                mood: { morning: 6, noon: 6, night: 7 },
                note,
              };
            }
            case 2: {
              const notes = [
                'å¤œå‹¤: SVå¼•ç¶™ã',
                'å¤œå‹¤æ˜ã‘: ä»®çœ ',
                'ã‚¢ãƒ©ãƒ¼ãƒˆå¤šç™ºãƒ»å¾©æ—§',
                'åœ¨åº«æ£šå¸ã‚µãƒãƒ¼ãƒˆ',
                'å¤œé–“å¯¾å¿œ: éšœå®³ãƒ†ã‚¹ãƒˆ',
              ];
              let note = pick(notes);
              if (dd % 6 === 0) note = 'ä½“èª¿â–³: æ—©ã‚å°±å¯ãƒ»æ°´åˆ†å¤šã‚';
              return {
                sleep_minutes: 7 * 60 + 30,
                fatigue: { morning: 4, noon: 5, night: 4 },
                mood: { morning: 4, noon: 5, night: 6 },
                note,
              };
            }
            case 3: {
              const notes = [
                'Udemy 2h / ç« 3',
                'ã‚¢ãƒ«ã‚´ç·´ 10å•',
                'å†™çµŒ 90m / ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…',
                'è‹±èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆèª­è§£',
                'å°èª²é¡Œæå‡ºãƒ»FBåæ˜ ',
              ];
              let note = pick(notes);
              if (dd % 8 === 0)
                note = 'é•·æ–‡: å­¦ç¿’ãƒ¡ãƒ¢ã€‚æŠ½è±¡åŒ–/è¨­è¨ˆãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šæ–¹æ³•ã‚’æ•´ç†ã€‚';
              return {
                sleep_minutes: 7 * 60,
                fatigue: { morning: 2, noon: 3, night: 4 },
                mood: { morning: 6, noon: 7, night: 7 },
                note,
              };
            }
            case 4: {
              const notes = [
                'ç§»å‹•: æ±äº¬â†’å¤§é˜ª',
                'è¦³å…‰: åšç‰©é¤¨ãƒ»å¸‚å ´',
                'æ¸‹æ»30m: ä¼‘æ†©å¤šã‚',
                'æ¸©æ³‰ãƒ»æ—©å¯',
                'é›¨: å±‹å†…ä¸­å¿ƒ',
              ];
              let note = pick(notes);
              return {
                sleep_minutes: 5 * 60,
                fatigue: { morning: 3, noon: 5, night: 6 },
                mood: { morning: 7, noon: 6, night: 6 },
                note,
              };
            }
            case 5: {
              const notes = [
                'è²·ã„å‡ºã—ãƒ»ä½œã‚Šç½®ã',
                'é€è¿: æœ/å¤•',
                'é€šé™¢ä»˜æ·»ãƒ»å‡¦æ–¹å—å–',
                'ãƒªãƒãƒ“ãƒªåŒè¡Œãƒ¡ãƒ¢',
                'å­¦æ ¡è¡Œäº‹: æ‡‡è«‡ä¼š',
                'çœ‹è­·è¨˜éŒ²ã®æ›´æ–°',
                'å¤œé–“å¯¾å¿œ: 2å›èµ·åºŠ',
              ];
              let note = pick(notes);
              if (dd % 9 === 0)
                note =
                  'é•·æ–‡: ã‚±ã‚¢è¨ˆç”»ã®è¦‹ç›´ã—æ¡ˆã€‚å½¹å‰²åˆ†æ‹…ã€é »åº¦ã€è² æ‹…åˆ†æ•£ã«ã¤ã„ã¦é–¢ä¿‚è€…ã¸ç›¸è«‡äºˆå®šã€‚';
              return {
                sleep_minutes: 6 * 60 + 30,
                fatigue: { morning: 3, noon: 4, night: 4 },
                mood: { morning: 7, noon: 7, night: 6 },
                note,
              };
            }
            case 6: {
              const notes = [
                'å®‰é™ãƒ»æ°´åˆ†è£œçµ¦',
                'è»½ã„æ•£æ­©20m',
                'ã‚¹ãƒˆãƒ¬ãƒƒãƒãƒ»æ¸©æµ´',
                'èª­æ›¸ãƒ»æ—©å¯',
                'é ­ç—›â–³: ã‚«ãƒ•ã‚§ã‚¤ãƒ³æ§ãˆã‚',
              ];
              let note = pick(notes);
              return {
                sleep_minutes: 9 * 60,
                fatigue: { morning: 1, noon: 2, night: 2 },
                mood: { morning: 5, noon: 6, night: 6 },
                note,
              };
            }
            default:
              return { sleep_minutes: 0, fatigue: {}, mood: {}, note: '' };
          }
        }
        const container = document.getElementById('monthwrap');
        for (const d of daysInMonth(m)) {
          let j;
          if (useSample) {
            j = {
              activities: samplePlanForDay(d, sampleId),
              ...sampleMetricsForDay(d, sampleId),
            };
          } else {
            const r = await fetch(`api/day?date=${d}`);
            j = await r.json();
          }
          const row = document.createElement('div');
          row.className = 'dayrow';
          // 1åˆ—ç›®: æ—¥ä»˜ï¼ˆDD ã®ã¿è¡¨ç¤ºï¼‰
          const dateEl = document.createElement('div');
          dateEl.className = 'daydate';
          dateEl.textContent = d.slice(8, 10);
          dateEl.title = d; // ãƒ•ãƒ«æ—¥ä»˜
          row.appendChild(dateEl);
          const content = document.createElement('div');
          content.className = 'daycontent';
          const grid = document.createElement('div');
          grid.className = 'grid48';
          const bySlot = new Map((j.activities || []).map((a) => [a.slot, a]));
          for (let i = 0; i < 48; i++) {
            const c = document.createElement('div');
            c.className = 'cell';
            const a = bySlot.get(i);
            const cat = a?.category || 'other';
            c.classList.add('cat-' + cat);
            c.title = String(a?.label || '');
            grid.appendChild(c);
          }
          content.appendChild(grid);
          // ãƒ¡ã‚¿è¡Œ: æŒ‡æ¨™ + å‚™è€ƒ
          const metricsEl = document.createElement('div');
          metricsEl.className = 'metrics';
          const mm = Number(j?.sleep_minutes || 0);
          const f = j?.fatigue || {};
          const mmm = j?.mood || {};
          const nt = String(j?.note || '').trim();
          const parts = [];
          if (mm > 0) parts.push(`ç¡${toHM(mm)}`);
          const fSum = (f.morning | 0) + (f.noon | 0) + (f.night | 0);
          if (fSum > 0) parts.push(`ç–²${f.morning | 0}/${f.noon | 0}/${f.night | 0}`);
          const mSum = (mmm.morning | 0) + (mmm.noon | 0) + (mmm.night | 0);
          if (mSum > 0) parts.push(`æ°—${mmm.morning | 0}/${mmm.noon | 0}/${mmm.night | 0}`);
          if (nt.length > 0) parts.push('ğŸ“');
          metricsEl.textContent = parts.join(' ');
          if (parts.length > 0) {
            metricsEl.title = `ç¡çœ :${mm > 0 ? toHM(mm) : '-'} / ç–²åŠ´:${f.morning | 0}/${
              f.noon | 0
            }/${f.night | 0} / æ°—åˆ†:${mmm.morning | 0}/${mmm.noon | 0}/${
              mmm.night | 0
            }${nt ? ' / ãƒ¡ãƒ¢ã‚ã‚Š' : ''}`;
          }
          const noteEl = document.createElement('div');
          noteEl.className = 'note';
          noteEl.textContent = nt;
          noteEl.title = nt;
          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.appendChild(metricsEl);
          meta.appendChild(noteEl);
          content.appendChild(meta);
          row.appendChild(content);
          row.addEventListener('click', () => {
            const u = new URL('./', location.href);
            u.searchParams.set('date', d);
            u.searchParams.set('pal', palette);
            window.open(u.toString(), '_blank');
          });
          container.appendChild(row);
        }
        const SAMPLE_META = {
          1: { t: 'æ¨™æº–å‹¤å‹™æ—¥', d: 'æ—¥å‹¤ãƒ»ç§»å‹•ãƒ»é‹å‹•ãƒ»å®¶æ—ãƒ»é£Ÿäº‹ãŒãƒãƒ©ãƒ³ã‚¹' },
          2: { t: 'å¤œå‹¤æ—¥', d: 'æ·±å¤œï½æ—©æœãŒä»•äº‹ã€æ˜¼é–“ã«ç¡çœ ' },
          3: { t: 'å­¦ç¿’é›†ä¸­æ—¥', d: 'æ—¥ä¸­ã¨å¤œã«å­¦ç¿’ãƒ–ãƒ­ãƒƒã‚¯ãŒé•·ã„' },
          4: { t: 'æ—…è¡Œæ—¥', d: 'ç§»å‹•ãŒé•·æ™‚é–“ã‚’å ã‚ã‚‹' },
          5: { t: 'å®¶æ—ãƒ»ã‚±ã‚¢æ—¥', d: 'å®¶æ—ãƒ»ã‚±ã‚¢ã®å¸¯ãŒä¸»' },
          6: { t: 'å›å¾©ï¼ˆä¼‘é¤Šï¼‰æ—¥', d: 'ç¡çœ ã¨ä¼‘æ†©ãŒå¤šã‚ã€è»½ã„é‹å‹•' },
        };
        const sel = document.getElementById('selSample');
        sel.value = String(sampleId);
        sel.addEventListener('change', () => {
          const u = new URL(location.href);
          u.searchParams.set('sample', sel.value);
          location.href = u.toString();
        });
        const selPal = document.getElementById('selPalette');
        selPal.value = palette;
        function applyPalette(p) {
          document.body.classList.toggle('palette-hc', p === 'hc');
          document.body.classList.toggle('palette-mid', p === 'mid');
          document.body.classList.toggle('palette-pastel', p === 'pastel');
          if (p === 'hc') {
            document.documentElement.style.setProperty('--grid-gap', '2px');
            document.documentElement.style.setProperty('--cell-border', '0');
            document.documentElement.style.setProperty('--cell-radius', '2px');
          } else if (p === 'mid') {
            document.documentElement.style.setProperty('--grid-gap', '2px');
            document.documentElement.style.setProperty('--cell-border', '0');
            document.documentElement.style.setProperty('--cell-radius', '2px');
          } else {
            document.documentElement.style.setProperty('--grid-gap', '1px');
            document.documentElement.style.setProperty('--cell-border', '1px solid #ccc');
            document.documentElement.style.setProperty('--cell-radius', '0');
          }
        }
        applyPalette(palette);
        selPal.addEventListener('change', () => {
          applyPalette(selPal.value);
          localStorage.setItem('dailylog.pal', selPal.value);
          const u = new URL(location.href);
          u.searchParams.set('pal', selPal.value);
          history.replaceState(null, '', u.toString());
        });
        const selH = document.getElementById('selHeight');
        const currentH = getComputedStyle(document.documentElement)
          .getPropertyValue('--cell-h')
          .trim()
          .replace('px', '');
        if (currentH) selH.value = currentH;
        selH.addEventListener('change', () => {
          document.documentElement.style.setProperty('--cell-h', selH.value + 'px');
          localStorage.setItem('dailylog.cell_h', selH.value);
          const u = new URL(location.href);
          u.searchParams.set('h', selH.value);
          history.replaceState(null, '', u.toString());
        });
        if (useSample) {
          const meta = SAMPLE_META[sampleId];
          const palLabel =
            palette === 'hc' ? 'é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ' : palette === 'mid' ? 'ãƒŸãƒ‰ãƒ«' : 'æ·¡è‰²ï¼ˆæ—§é…è‰²ï¼‰';
          document.getElementById('subtitle').textContent =
            `ã‚µãƒ³ãƒ—ãƒ«${sampleId}: ${meta?.t}ï¼ˆ${meta?.d}ï¼‰ï½œé…è‰²: ${palLabel} - DBä¸è¦ã®ãƒ¢ãƒƒã‚¯è¡¨ç¤º`;
        }
        document.getElementById('btnPrint').addEventListener('click', () => window.print());
      })();

      // --- helpers ---
      function toHM(mins) {
        const h = Math.floor(mins / 60);
        const m2 = mins % 60;
        return `${h}:${String(m2).padStart(2, '0')}`;
      }
    </script>
  </body>
</html>
